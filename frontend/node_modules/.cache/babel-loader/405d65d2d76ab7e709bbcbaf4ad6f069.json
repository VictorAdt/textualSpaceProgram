{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\doubl\\\\Documents\\\\Projets\\\\Try\\\\rocketbuilder\\\\frontend\\\\src\\\\components\\\\controls\\\\ShipControl.js\";\nimport React, { Component } from 'react';\nimport { ShipContext } from '../../contexts/ShipProvider';\nimport axios from 'axios';\nexport default class ShipControl extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      ship: null,\n      stage: null,\n      celestialBody: null\n    };\n\n    this.fromSurfaceToOrbit = () => {\n      let stage = this.context.state.stage;\n      let requierdDV = Math.sqrt(this.state.ship.celest_body.mu / this.state.ship.celest_body.radius) * 1000 * this.state.ship.celest_body.atmosphere;\n      let dvByStageAfterBurn = [...this.context.state.deltaVByStage];\n      let dvbystage = [...this.context.state.deltaVByStage];\n      let dif = []; // Minus deltaV\n\n      for (let i = 0; i < dvByStageAfterBurn.length; i++) {\n        if (dvByStageAfterBurn[i] > requierdDV) {\n          dvByStageAfterBurn[i] -= requierdDV;\n          requierdDV = 0;\n        } else {\n          requierdDV -= dvByStageAfterBurn[i];\n          dvByStageAfterBurn[i] = 0;\n        }\n      }\n\n      console.log('dvbystage', dvbystage);\n      console.log('dvByStageAfterBurn', dvByStageAfterBurn); // stage separation\n\n      for (let i = 0; i < dvByStageAfterBurn.length; i++) {\n        if (dvByStageAfterBurn[i] === 0) {\n          stage.splice(0, 1);\n          dvByStageAfterBurn.splice(0, 1);\n          dvbystage.splice(0, 1);\n        }\n      } // getDv % diference\n\n\n      for (let i = 0; i < dvbystage.length; i++) {\n        dif.push(dvByStageAfterBurn[i] / (dvbystage[i] / 100));\n      }\n\n      console.log('dif', dif); // updateFuelLastStage\n\n      for (let i = 0; i < stage[0].tank.length; i++) {\n        stage[0].tank[i].remainingFuel = stage[0].tank[i].remainingFuel / 100 * dif[0];\n      } //stage update\n\n\n      this.context.shipSetStage(stage);\n    };\n  }\n\n  async componentDidMount() {\n    try {\n      const shiptRes = await axios({\n        method: 'GET',\n        url: `http://localhost:1337/ships/${this.props.location.id}`\n      });\n      const fetchedShip = shiptRes.data;\n      let rocketStages = [];\n\n      for (let i = 0; i < fetchedShip.stage.length; i++) {\n        let stage = {\n          commandModule: [],\n          engine: [],\n          tank: []\n        };\n        let currentStage = i;\n\n        for (let i = 0; i < fetchedShip.stage[currentStage].tank.length; i++) {\n          stage.tank.push(fetchedShip.stage[currentStage].tank[i].tank);\n        }\n\n        for (let i = 0; i < fetchedShip.stage[currentStage].engine.length; i++) {\n          stage.engine.push(fetchedShip.stage[currentStage].engine[i].engine);\n        }\n\n        for (let i = 0; i < fetchedShip.stage[currentStage].commandModule.length; i++) {\n          stage.commandModule.push(fetchedShip.stage[currentStage].commandModule[i].commandModule);\n        }\n\n        currentStage++;\n        rocketStages.push(stage);\n      }\n\n      console.log('rocketStages', rocketStages);\n      this.setState({\n        stage: rocketStages,\n        ship: fetchedShip\n      }, () => {\n        this.context.shipSetStage(rocketStages);\n      });\n      console.log('fetchedShip', fetchedShip);\n    } catch (err) {\n      alert(err);\n    }\n\n    console.log(this.state.ship, this.state.stage);\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"shipControl\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => this.fromSurfaceToOrbit(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 17\n      }\n    }, \"go to orbit :\"));\n  }\n\n}\nShipControl.contextType = ShipContext;","map":{"version":3,"sources":["C:/Users/doubl/Documents/Projets/Try/rocketbuilder/frontend/src/components/controls/ShipControl.js"],"names":["React","Component","ShipContext","axios","ShipControl","state","ship","stage","celestialBody","fromSurfaceToOrbit","context","requierdDV","Math","sqrt","celest_body","mu","radius","atmosphere","dvByStageAfterBurn","deltaVByStage","dvbystage","dif","i","length","console","log","splice","push","tank","remainingFuel","shipSetStage","componentDidMount","shiptRes","method","url","props","location","id","fetchedShip","data","rocketStages","commandModule","engine","currentStage","setState","err","alert","render","contextType"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { ShipContext } from '../../contexts/ShipProvider'\r\nimport axios from 'axios';\r\n\r\n\r\nexport default class ShipControl extends Component {\r\n    state ={\r\n        ship: null,\r\n        stage: null,\r\n        celestialBody: null\r\n    }\r\n\r\n    async componentDidMount() {\r\n        try {\r\n            const shiptRes = await axios({\r\n                method: 'GET',\r\n                url: `http://localhost:1337/ships/${this.props.location.id}`\r\n            });\r\n            const fetchedShip = shiptRes.data\r\n            let rocketStages = []\r\n            for (let i = 0; i < fetchedShip.stage.length; i++) {\r\n                let stage = {\r\n                    commandModule: [],\r\n                    engine: [],\r\n                    tank: [],\r\n                }\r\n                let currentStage = i\r\n                for (let i = 0; i < fetchedShip.stage[currentStage].tank.length; i++) {\r\n                    stage.tank.push(fetchedShip.stage[currentStage].tank[i].tank)\r\n                }\r\n                for (let i = 0; i < fetchedShip.stage[currentStage].engine.length; i++) {\r\n                    stage.engine.push(fetchedShip.stage[currentStage].engine[i].engine)\r\n                }\r\n                for (let i = 0; i < fetchedShip.stage[currentStage].commandModule.length; i++) {\r\n                    stage.commandModule.push(fetchedShip.stage[currentStage].commandModule[i].commandModule)\r\n                }\r\n                currentStage++\r\n                rocketStages.push(stage)\r\n            }\r\n            console.log('rocketStages', rocketStages);\r\n            this.setState({ \r\n                stage: rocketStages,\r\n                ship: fetchedShip\r\n            }, () => {\r\n                this.context.shipSetStage(rocketStages)\r\n            })\r\n            console.log('fetchedShip', fetchedShip)\r\n        } catch (err){\r\n            alert(err);\r\n        }\r\n        console.log(this.state.ship, this.state.stage);\r\n    }\r\n\r\n    fromSurfaceToOrbit = () => {\r\n        let stage = this.context.state.stage\r\n        let requierdDV = Math.sqrt(this.state.ship.celest_body.mu/this.state.ship.celest_body.radius) * 1000 * this.state.ship.celest_body.atmosphere\r\n        let dvByStageAfterBurn = [...this.context.state.deltaVByStage]\r\n        let dvbystage = [...this.context.state.deltaVByStage]\r\n        let dif = []\r\n\r\n        // Minus deltaV\r\n        for(let i = 0; i < dvByStageAfterBurn.length; i++ ){\r\n            if(dvByStageAfterBurn[i] > requierdDV){\r\n                dvByStageAfterBurn[i] -= requierdDV\r\n                requierdDV = 0\r\n            } else{\r\n                requierdDV -= dvByStageAfterBurn[i]\r\n                dvByStageAfterBurn[i] = 0\r\n            }\r\n        }\r\n\r\n        console.log('dvbystage', dvbystage);\r\n        console.log('dvByStageAfterBurn', dvByStageAfterBurn);\r\n\r\n        // stage separation\r\n        for(let i = 0; i < dvByStageAfterBurn.length; i++){  \r\n            if(dvByStageAfterBurn[i] === 0){\r\n                stage.splice(0,1)\r\n                dvByStageAfterBurn.splice(0,1)\r\n                dvbystage.splice(0,1)\r\n            }\r\n        }\r\n        \r\n        // getDv % diference\r\n        for(let i = 0; i< dvbystage.length; i++){\r\n            dif.push( dvByStageAfterBurn[i] / (dvbystage[i] / 100) )\r\n        }\r\n        console.log('dif' , dif);\r\n        \r\n        // updateFuelLastStage\r\n        for(let i = 0; i < stage[0].tank.length; i++){\r\n            stage[0].tank[i].remainingFuel = stage[0].tank[i].remainingFuel / 100 * dif[0]\r\n        }\r\n\r\n        //stage update\r\n        this.context.shipSetStage(stage)\r\n\r\n    }\r\n\r\n    render() {\r\n\r\n        return (\r\n            <div className=\"shipControl\">\r\n                <button onClick={() => this.fromSurfaceToOrbit()}>go to orbit :</button>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nShipControl.contextType = ShipContext;\r\n"]},"metadata":{},"sourceType":"module"}