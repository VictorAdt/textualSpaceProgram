{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\doubl\\\\Documents\\\\Projets\\\\Try\\\\rocketbuilder\\\\frontend\\\\src\\\\components\\\\controls\\\\ManoeuvreControl.js\";\nimport React, { Component } from 'react';\nimport { ShipContext } from '../../contexts/ShipProvider';\nimport { updateShip } from '../../utils/updateShip';\nimport { deleteShip } from '../../utils/deleteShip';\nimport FromSurface from './FromSurface';\nimport FromOrbit from './FromOrbit';\nimport axios from 'axios';\nexport default class ManoeuvreControl extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      celestBodies: []\n    };\n\n    this.fromSurfaceToOrbit = () => {\n      let stage = this.context.state.stage;\n      let requierdDV = Math.sqrt(this.context.state.ship.celest_body.mu / this.context.state.ship.celest_body.radius) * 1000 * this.context.state.ship.celest_body.atmosphere;\n      let dvByStageAfterBurn = [...this.context.state.deltaVByStage];\n      let dvbystage = [...this.context.state.deltaVByStage];\n      let dif = [];\n      console.log('reqDV', requierdDV); // Minus deltaV\n\n      for (let i = 0; i < dvByStageAfterBurn.length; i++) {\n        if (dvByStageAfterBurn[i] > requierdDV) {\n          dvByStageAfterBurn[i] -= requierdDV;\n          requierdDV = 0;\n          console.log('Congratulation, you reach orbit');\n        } else {\n          requierdDV -= dvByStageAfterBurn[i];\n          dvByStageAfterBurn[i] = 0;\n        }\n      }\n\n      if (requierdDV !== 0) {\n        console.log('you crashed');\n        deleteShip(this.context.state.ship.id);\n        return;\n      }\n\n      console.log('dvbystage', dvbystage);\n      console.log('dvByStageAfterBurn', dvByStageAfterBurn); // stage separation\n\n      for (let i = 0; i < dvByStageAfterBurn.length; i++) {\n        if (dvByStageAfterBurn[i] === 0) {\n          stage.splice(0, 1);\n          dvByStageAfterBurn.splice(0, 1);\n          dvbystage.splice(0, 1);\n        }\n      } // getDv % diference\n\n\n      for (let i = 0; i < dvbystage.length; i++) {\n        dif.push(dvByStageAfterBurn[i] / (dvbystage[i] / 100));\n      }\n\n      console.log('dif', dif); // updateFuelLastStage\n\n      for (let i = 0; i < stage[0].tank.length; i++) {\n        stage[0].tank[i].remainingFuel = stage[0].tank[i].remainingFuel / 100 * dif[0] / 1.6;\n      } //stage update\n\n\n      this.context.shipSetStage(stage);\n      this.context.updateLocation('orbit');\n      updateShip(stage, this.context.state.ship.name, 'orbit', this.context.state.ship.celest_body.id, this.context.state.ship.id, this.context.state.ship.celest_body.lowOrbit);\n      console.log('manoeuvre context ', this.context);\n    };\n\n    this.burn = (stage, dv, requierdDv) => {\n      return stage;\n    };\n\n    this.fromOrbitToSurface = () => {\n      let requierdDV = Math.sqrt(this.context.state.ship.celest_body.mu / this.context.state.ship.celest_body.radius) * 1000 / this.context.state.ship.celest_body.atmosphere;\n      let stage = this.context.state.stage;\n      let dvByStageAfterBurn = [...this.context.state.deltaVByStage];\n      let dvbystage = [...this.context.state.deltaVByStage];\n      let dif = [];\n      console.log('reqDV', requierdDV); // Minus deltaV\n\n      for (let i = 0; i < dvByStageAfterBurn.length; i++) {\n        if (dvByStageAfterBurn[i] > requierdDV) {\n          dvByStageAfterBurn[i] -= requierdDV;\n          requierdDV = 0;\n          console.log('congratulation, you landed');\n        } else {\n          requierdDV -= dvByStageAfterBurn[i];\n          dvByStageAfterBurn[i] = 0;\n        }\n      }\n\n      if (requierdDV !== 0) {\n        console.log('you crashed');\n        deleteShip(this.context.state.ship.id);\n        return;\n      }\n\n      console.log('dvbystage', dvbystage);\n      console.log('dvByStageAfterBurn', dvByStageAfterBurn); // stage separation\n\n      for (let i = 0; i < dvByStageAfterBurn.length; i++) {\n        if (dvByStageAfterBurn[i] === 0) {\n          stage.splice(0, 1);\n          dvByStageAfterBurn.splice(0, 1);\n          dvbystage.splice(0, 1);\n        }\n      } // getDv % diference\n\n\n      for (let i = 0; i < dvbystage.length; i++) {\n        dif.push(dvByStageAfterBurn[i] / (dvbystage[i] / 100));\n      }\n\n      console.log('dif', dif); // updateFuelLastStage\n\n      for (let i = 0; i < stage[0].tank.length; i++) {\n        stage[0].tank[i].remainingFuel = stage[0].tank[i].remainingFuel / 100 * dif[0] / 1.6;\n      } //stage update\n\n\n      this.context.shipSetStage(stage);\n      this.context.updateLocation('ground');\n      updateShip(stage, this.context.state.ship.name, 'ground', this.context.state.ship.celest_body.id, this.context.state.ship.id, 0);\n      console.log('manoeuvre context ', this.context);\n    };\n\n    this.commandModuleReEntry = () => {\n      let requierdDV = Math.sqrt(this.context.state.ship.celest_body.mu / this.context.state.ship.celest_body.radius) * 100;\n      console.log(requierdDV);\n    };\n\n    this.getCelestBody = async id => {\n      try {\n        const celestBodyRes = await axios({\n          method: 'GET',\n          url: `http://localhost:1337/celest-bodies/${id}`\n        });\n        const fetchedCelestBody = celestBodyRes.data;\n        return fetchedCelestBody.apoapsis;\n      } catch (e) {\n        alert(e);\n      }\n    };\n\n    this.escapeFromOrbit = async () => {\n      let requierdDV = this.context.state.ship.celest_body.escapeVelocity;\n      console.log(requierdDV);\n      let stage = this.context.state.stage;\n      let dvByStageAfterBurn = [...this.context.state.deltaVByStage];\n      let dvbystage = [...this.context.state.deltaVByStage];\n      let dif = [];\n      console.log('reqDV', requierdDV);\n      const altitude = await this.getCelestBody(this.context.state.ship.celest_body.id);\n      console.log(altitude); // Minus deltaV\n\n      for (let i = 0; i < dvByStageAfterBurn.length; i++) {\n        if (dvByStageAfterBurn[i] > requierdDV) {\n          dvByStageAfterBurn[i] -= requierdDV;\n          requierdDV = 0;\n          console.log('you are now orbiting around the sun');\n        } else {\n          requierdDV -= dvByStageAfterBurn[i];\n          dvByStageAfterBurn[i] = 0;\n        }\n      }\n\n      if (requierdDV !== 0) {\n        console.log('no more fuel');\n        return;\n      }\n\n      console.log('dvbystage', dvbystage);\n      console.log('dvByStageAfterBurn', dvByStageAfterBurn); // stage separation\n\n      for (let i = 0; i < dvByStageAfterBurn.length; i++) {\n        if (dvByStageAfterBurn[i] === 0) {\n          stage.splice(0, 1);\n          dvByStageAfterBurn.splice(0, 1);\n          dvbystage.splice(0, 1);\n        }\n      } // getDv % diference\n\n\n      for (let i = 0; i < dvbystage.length; i++) {\n        dif.push(dvByStageAfterBurn[i] / (dvbystage[i] / 100));\n      }\n\n      console.log('dif', dif); // updateFuelLastStage\n\n      for (let i = 0; i < stage[0].tank.length; i++) {\n        stage[0].tank[i].remainingFuel = stage[0].tank[i].remainingFuel / 100 * dif[0] / 1.6;\n      } //stage update\n\n\n      this.context.shipSetStage(stage);\n      this.context.updateLocation('orbit');\n      updateShip(stage, this.context.state.ship.name, 'orbit', 3, this.context.state.ship.id, this.context.state.ship.celest_body.apoapsis, altitude);\n      console.log('manoeuvre context ', this.context);\n    };\n\n    this.childTransfer = () => {\n      let requierdDV;\n      console.log(requierdDV);\n    };\n\n    this.planetTransfert = targetBodyPeriapsis => {\n      let requierdDV = parseInt(Math.sqrt(this.context.state.ship.celest_body.mu / this.context.state.ship.altitudeFromParent) * Math.sqrt(Math.pow(2 * targetBodyPeriapsis, 2) / (this.context.state.ship.altitudeFromParent + targetBodyPeriapsis) - 1));\n      console.log(requierdDV);\n    };\n  }\n\n  async componentDidMount() {\n    if (this.context.state.ship.celest_body) {\n      try {\n        const celestBodyRes = await axios({\n          method: 'GET',\n          url: `http://localhost:1337/celest-bodies/`\n        });\n        const fetchedCelestBody = celestBodyRes.data;\n        this.setState({\n          celestBodies: fetchedCelestBody\n        });\n        console.log('fetchedCelestBody', fetchedCelestBody);\n      } catch (e) {\n        alert(e);\n      }\n    }\n  }\n\n  render() {\n    if (this.context.state.ship.locationStatus === 'orbit') {\n      return /*#__PURE__*/React.createElement(ShipContext.Provider, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 24\n        }\n      }, /*#__PURE__*/React.createElement(FromOrbit, {\n        fromOrbitToSurface: this.fromOrbitToSurface,\n        escapeFromOrbit: this.escapeFromOrbit,\n        childTransfer: this.childTransfer,\n        commandModuleReEntry: this.commandModuleReEntry,\n        planetTransfert: targetBodyPeriapsis => this.planetTransfert(targetBodyPeriapsis),\n        celestBodiesList: this.state.celest_body,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 25\n        }\n      }));\n    } else if (this.context.state.ship.locationStatus === 'ground') {\n      return /*#__PURE__*/React.createElement(ShipContext.Provider, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 24\n        }\n      }, /*#__PURE__*/React.createElement(FromSurface, {\n        fromSurfaceToOrbit: this.fromSurfaceToOrbit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 25\n        }\n      }));\n    } else {\n      return '';\n    }\n  }\n\n}\nManoeuvreControl.contextType = ShipContext;","map":{"version":3,"sources":["C:/Users/doubl/Documents/Projets/Try/rocketbuilder/frontend/src/components/controls/ManoeuvreControl.js"],"names":["React","Component","ShipContext","updateShip","deleteShip","FromSurface","FromOrbit","axios","ManoeuvreControl","state","celestBodies","fromSurfaceToOrbit","stage","context","requierdDV","Math","sqrt","ship","celest_body","mu","radius","atmosphere","dvByStageAfterBurn","deltaVByStage","dvbystage","dif","console","log","i","length","id","splice","push","tank","remainingFuel","shipSetStage","updateLocation","name","lowOrbit","burn","dv","requierdDv","fromOrbitToSurface","commandModuleReEntry","getCelestBody","celestBodyRes","method","url","fetchedCelestBody","data","apoapsis","e","alert","escapeFromOrbit","escapeVelocity","altitude","childTransfer","planetTransfert","targetBodyPeriapsis","parseInt","altitudeFromParent","pow","componentDidMount","setState","render","locationStatus","contextType"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { ShipContext } from '../../contexts/ShipProvider'\r\nimport { updateShip } from '../../utils/updateShip'\r\nimport { deleteShip } from '../../utils/deleteShip'\r\nimport FromSurface from './FromSurface'\r\nimport FromOrbit from './FromOrbit'\r\nimport axios from 'axios';\r\n\r\nexport default class ManoeuvreControl extends Component {\r\n    state={\r\n        celestBodies: []\r\n    }\r\n    async componentDidMount() {\r\n        if(this.context.state.ship.celest_body){\r\n        try {\r\n            const celestBodyRes = await axios({\r\n                method: 'GET',\r\n                url: `http://localhost:1337/celest-bodies/`\r\n            })\r\n            const fetchedCelestBody = celestBodyRes.data\r\n            this.setState({celestBodies: fetchedCelestBody})\r\n            console.log('fetchedCelestBody', fetchedCelestBody);\r\n        } catch(e){\r\n            alert(e)\r\n        }}\r\n    }\r\n\r\n    fromSurfaceToOrbit = () => {\r\n        let stage = this.context.state.stage\r\n        let requierdDV = Math.sqrt(this.context.state.ship.celest_body.mu / this.context.state.ship.celest_body.radius) * 1000 * this.context.state.ship.celest_body.atmosphere\r\n        let dvByStageAfterBurn = [...this.context.state.deltaVByStage]\r\n        let dvbystage = [...this.context.state.deltaVByStage]\r\n        let dif = []\r\n        console.log('reqDV', requierdDV);\r\n        // Minus deltaV\r\n        for (let i = 0; i < dvByStageAfterBurn.length; i++) {\r\n            if (dvByStageAfterBurn[i] > requierdDV) {\r\n                dvByStageAfterBurn[i] -= requierdDV\r\n                requierdDV = 0\r\n                console.log('Congratulation, you reach orbit')\r\n            } else {\r\n                requierdDV -= dvByStageAfterBurn[i]\r\n                dvByStageAfterBurn[i] = 0\r\n            }\r\n        }\r\n        if (requierdDV !== 0) {\r\n            console.log('you crashed')\r\n            deleteShip(this.context.state.ship.id)\r\n            return\r\n        }\r\n        console.log('dvbystage', dvbystage);\r\n        console.log('dvByStageAfterBurn', dvByStageAfterBurn);\r\n        // stage separation\r\n        for (let i = 0; i < dvByStageAfterBurn.length; i++) {\r\n            if (dvByStageAfterBurn[i] === 0) {\r\n                stage.splice(0, 1)\r\n                dvByStageAfterBurn.splice(0, 1)\r\n                dvbystage.splice(0, 1)\r\n            }\r\n        }\r\n        // getDv % diference\r\n        for (let i = 0; i < dvbystage.length; i++) {\r\n            dif.push(dvByStageAfterBurn[i] / (dvbystage[i] / 100))\r\n        }\r\n        console.log('dif', dif);\r\n        // updateFuelLastStage\r\n        for (let i = 0; i < stage[0].tank.length; i++) {\r\n            stage[0].tank[i].remainingFuel = (stage[0].tank[i].remainingFuel / 100 * dif[0]) / 1.6\r\n        }\r\n        //stage update\r\n        this.context.shipSetStage(stage)\r\n        this.context.updateLocation('orbit')\r\n        updateShip(stage, this.context.state.ship.name, 'orbit', this.context.state.ship.celest_body.id, this.context.state.ship.id, this.context.state.ship.celest_body.lowOrbit)\r\n        console.log('manoeuvre context ', this.context);\r\n    }\r\n\r\n    burn = (stage, dv , requierdDv) => {\r\n\r\n        return stage\r\n    }\r\n\r\n    fromOrbitToSurface = () => {\r\n        let requierdDV = Math.sqrt(this.context.state.ship.celest_body.mu / this.context.state.ship.celest_body.radius) * 1000 / this.context.state.ship.celest_body.atmosphere\r\n        let stage = this.context.state.stage\r\n        let dvByStageAfterBurn = [...this.context.state.deltaVByStage]\r\n        let dvbystage = [...this.context.state.deltaVByStage]\r\n        let dif = []\r\n        console.log('reqDV', requierdDV);\r\n        // Minus deltaV\r\n        for (let i = 0; i < dvByStageAfterBurn.length; i++) {\r\n            if (dvByStageAfterBurn[i] > requierdDV) {\r\n                dvByStageAfterBurn[i] -= requierdDV\r\n                requierdDV = 0\r\n                console.log('congratulation, you landed')\r\n            } else {\r\n                requierdDV -= dvByStageAfterBurn[i]\r\n                dvByStageAfterBurn[i] = 0\r\n            }\r\n        }\r\n        if (requierdDV !== 0) {\r\n            console.log('you crashed')\r\n            deleteShip(this.context.state.ship.id)\r\n            return\r\n        }\r\n        console.log('dvbystage', dvbystage);\r\n        console.log('dvByStageAfterBurn', dvByStageAfterBurn);\r\n        // stage separation\r\n        for (let i = 0; i < dvByStageAfterBurn.length; i++) {\r\n            if (dvByStageAfterBurn[i] === 0) {\r\n                stage.splice(0, 1)\r\n                dvByStageAfterBurn.splice(0, 1)\r\n                dvbystage.splice(0, 1)\r\n            }\r\n        }\r\n        // getDv % diference\r\n        for (let i = 0; i < dvbystage.length; i++) {\r\n            dif.push(dvByStageAfterBurn[i] / (dvbystage[i] / 100))\r\n        }\r\n        console.log('dif', dif);\r\n        // updateFuelLastStage\r\n        for (let i = 0; i < stage[0].tank.length; i++) {\r\n            stage[0].tank[i].remainingFuel = (stage[0].tank[i].remainingFuel / 100 * dif[0]) / 1.6\r\n        }\r\n        //stage update\r\n        this.context.shipSetStage(stage)\r\n        this.context.updateLocation('ground')\r\n        updateShip(stage, this.context.state.ship.name, 'ground', this.context.state.ship.celest_body.id, this.context.state.ship.id, 0)\r\n        console.log('manoeuvre context ', this.context);\r\n    }\r\n\r\n    commandModuleReEntry = () => {\r\n        let requierdDV = Math.sqrt(this.context.state.ship.celest_body.mu / this.context.state.ship.celest_body.radius) * 100 \r\n        console.log(requierdDV)\r\n    }\r\n\r\n    getCelestBody = async id => {\r\n        try {\r\n            const celestBodyRes = await axios({\r\n                method: 'GET',\r\n                url: `http://localhost:1337/celest-bodies/${id}`\r\n            })\r\n            const fetchedCelestBody = celestBodyRes.data\r\n            return  fetchedCelestBody.apoapsis\r\n        } catch(e){\r\n            alert(e)\r\n        }\r\n    }\r\n    \r\n     escapeFromOrbit = async () => {\r\n        let requierdDV = this.context.state.ship.celest_body.escapeVelocity\r\n        console.log(requierdDV)\r\n        let stage = this.context.state.stage\r\n        let dvByStageAfterBurn = [...this.context.state.deltaVByStage]\r\n        let dvbystage = [...this.context.state.deltaVByStage]\r\n        let dif = []\r\n        console.log('reqDV', requierdDV);\r\n\r\n        const altitude = await this.getCelestBody(this.context.state.ship.celest_body.id)\r\n        console.log(altitude);\r\n\r\n        // Minus deltaV\r\n        for (let i = 0; i < dvByStageAfterBurn.length; i++) {\r\n            if (dvByStageAfterBurn[i] > requierdDV) {\r\n                dvByStageAfterBurn[i] -= requierdDV\r\n                requierdDV = 0\r\n                console.log('you are now orbiting around the sun')\r\n            } else {\r\n                requierdDV -= dvByStageAfterBurn[i]\r\n                dvByStageAfterBurn[i] = 0\r\n            }\r\n        }\r\n        if (requierdDV !== 0) {\r\n            console.log('no more fuel')\r\n            return\r\n        }\r\n        console.log('dvbystage', dvbystage);\r\n        console.log('dvByStageAfterBurn', dvByStageAfterBurn);\r\n        // stage separation\r\n        for (let i = 0; i < dvByStageAfterBurn.length; i++) {\r\n            if (dvByStageAfterBurn[i] === 0) {\r\n                stage.splice(0, 1)\r\n                dvByStageAfterBurn.splice(0, 1)\r\n                dvbystage.splice(0, 1)\r\n            }\r\n        }\r\n        // getDv % diference\r\n        for (let i = 0; i < dvbystage.length; i++) {\r\n            dif.push(dvByStageAfterBurn[i] / (dvbystage[i] / 100))\r\n        }\r\n        console.log('dif', dif);\r\n        // updateFuelLastStage\r\n        for (let i = 0; i < stage[0].tank.length; i++) {\r\n            stage[0].tank[i].remainingFuel = (stage[0].tank[i].remainingFuel / 100 * dif[0]) / 1.6\r\n        }\r\n        //stage update\r\n        this.context.shipSetStage(stage)\r\n        this.context.updateLocation('orbit')\r\n        updateShip(stage, this.context.state.ship.name, 'orbit', 3 , this.context.state.ship.id, this.context.state.ship.celest_body.apoapsis, altitude)\r\n        console.log('manoeuvre context ', this.context);\r\n    }\r\n\r\n    childTransfer = () => {\r\n        let requierdDV\r\n        console.log(requierdDV)\r\n    }\r\n\r\n    planetTransfert = (targetBodyPeriapsis) => {\r\n        let requierdDV = parseInt(Math.sqrt( this.context.state.ship.celest_body.mu / this.context.state.ship.altitudeFromParent) * (Math.sqrt(Math.pow(2 * targetBodyPeriapsis, 2) / (this.context.state.ship.altitudeFromParent + targetBodyPeriapsis) -1 )))\r\n        console.log(requierdDV);\r\n    }\r\n\r\n    render() {\r\n            if (this.context.state.ship.locationStatus === 'orbit') {\r\n                return <ShipContext.Provider>\r\n                        <FromOrbit\r\n                            fromOrbitToSurface={this.fromOrbitToSurface}\r\n                            escapeFromOrbit={this.escapeFromOrbit}\r\n                            childTransfer={this.childTransfer}\r\n                            commandModuleReEntry={this.commandModuleReEntry}\r\n                            planetTransfert={(targetBodyPeriapsis) => this.planetTransfert(targetBodyPeriapsis)}\r\n                            celestBodiesList={this.state.celest_body}\r\n                        />\r\n                    </ShipContext.Provider>\r\n            } else if (this.context.state.ship.locationStatus === 'ground') {\r\n                return <ShipContext.Provider>\r\n                        <FromSurface\r\n                            fromSurfaceToOrbit={this.fromSurfaceToOrbit}\r\n                        />\r\n                     </ShipContext.Provider>\r\n            }else {\r\n                return ''\r\n            }\r\n    }\r\n}\r\n\r\nManoeuvreControl.contextType = ShipContext;\r\n"]},"metadata":{},"sourceType":"module"}